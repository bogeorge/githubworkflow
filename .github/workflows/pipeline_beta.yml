#----------------------------------------------------------------------------------------------------------------------
# This workflow should only execute when code is committed to beta which means it needs to be tested before going to
# the beta (integrated development environment) AND the alpha environment
#----------------------------------------------------------------------------------------------------------------------
name: Beta Pipeline

on: 
  push:
    branches:
      - 'beta'

env:
  aws-stack-name: sample-application

jobs:

  build:
     uses: ./.github/workflows/build_yarn.yml

  deploy-beta: 
    uses: ./.github/workflows/deploy_lambda.yml
    with:
      app-environment: beta
      aws-region: us-east-2
      aws-stack-name: "${{ env.aws-stack-name }}-beta"
    secrets: inherit # pass all secrets
    needs: [ build ]

  deploy-alpha:
    uses: ./.github/workflows/deploy_lambda.yml
    with:
      app-environment: alpha
      aws-region: us-east-2
      aws-stack-name: "${{ env.aws-stack-name }}-alpha"
    secrets: inherit # pass all secrets
    needs: [ build ]    